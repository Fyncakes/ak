{% extends "base.html" %}

{% block title %}Our Cakes{% endblock %}

{% block head_extra %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/customer.css') }}">
    <style>
        /* New styles to create a responsive 4-column grid */
        .cake-container {
            /* On large screens (desktops), show 4 columns */
            grid-template-columns: repeat(4, 1fr);
        }

        /* For smaller screens */
        @media (max-width: 1200px) {
            .cake-container {
                /* On medium screens (laptops/tablets), show 3 columns */
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 900px) {
            .cake-container {
                /* On smaller tablets, show 2 columns */
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .cake-container {
                /* On mobile phones, show 1 column */
                grid-template-columns: 1fr;
            }
        }
    </style>
{% endblock %}

{% block content %}
<div class="customer-container">
    <h1 class="page-title">Our Cakes</h1>

    <div class="cake-container">
        {% for cake in cakes %}
        <div class="cake-card">
            <div class="cake-card-image">
                <img src="{{ cake.image }}" alt="{{ cake.name }}">
            </div>
            <div class="cake-card-content">
                <h3>{{ cake.name }}</h3>
                <p>{{ cake.description }}</p>
                <p class="price">${{ "%.2f"|format(cake.price) }}</p>
                <button
                    class="order-button"
                    data-name="{{ cake.name }}"
                    data-image="{{ cake.image }}"
                    data-price="{{ cake.price }}"
                    data-description="{{ cake.description }}"
                    onclick="addToCart(this)"
                >
                    <i class="fas fa-shopping-cart"></i> Add to Cart
                </button>
            </div>
        </div>
        {% else %}
        <div class="no-cakes-message">
            <h2>Our bakers are busy!</h2>
            <p>There are currently no cakes available. Please check back soon!</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Retrieve stored products if any exist, or initialize an empty array
    let selectedProducts = JSON.parse(localStorage.getItem("selectedProducts")) || [];

    // Function to add a selected cake to the cart
    function addToCart(button) {
        // Create a new product object by reading the data attributes from the button
        const product = {
            name: button.dataset.name,
            price: parseFloat(button.dataset.price),
            description: button.dataset.description,
            imageUrl: button.dataset.image
        };

        // Add the new product object to our selectedProducts array
        selectedProducts.push(product);

        // Store the updated array in local storage
        localStorage.setItem("selectedProducts", JSON.stringify(selectedProducts));

        // Give the user feedback
        alert(`'${product.name}' has been added to your cart!`);
        
        // Optional: Update a cart counter in the nav if you have one
    }
</script>
{% endblock %}

