<!-- Comments Section Component -->
<div class="comments-section" id="comments-section">
    <div class="comments-header">
        <h3><i class="fas fa-comments"></i> Customer Reviews</h3>
        <p>Share your experience with FynCakes</p>
    </div>
    
    <!-- Comments Display -->
    <div class="comments-display" id="comments-display">
        <div class="loading-comments">
            <i class="fas fa-spinner fa-spin"></i>
            <span>Loading comments...</span>
        </div>
    </div>
    
    <!-- Add Comment Form -->
    <div class="add-comment-form">
        <h4>Leave a Review</h4>
        <form id="comment-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="comment-name">Your Name *</label>
                    <input type="text" id="comment-name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="comment-email">Email (Optional)</label>
                    <input type="email" id="comment-email" name="email">
                </div>
            </div>
            
            <div class="form-group">
                <label for="comment-rating">Rating</label>
                <div class="rating-input">
                    <input type="radio" id="star5" name="rating" value="5" checked>
                    <label for="star5" class="star">★</label>
                    <input type="radio" id="star4" name="rating" value="4">
                    <label for="star4" class="star">★</label>
                    <input type="radio" id="star3" name="rating" value="3">
                    <label for="star3" class="star">★</label>
                    <input type="radio" id="star2" name="rating" value="2">
                    <label for="star2" class="star">★</label>
                    <input type="radio" id="star1" name="rating" value="1">
                    <label for="star1" class="star">★</label>
                </div>
            </div>
            
            <div class="form-group">
                <label for="comment-text">Your Review *</label>
                <textarea id="comment-text" name="comment" rows="4" placeholder="Tell us about your experience with FynCakes..." required></textarea>
            </div>
            
            <button type="submit" class="submit-comment-btn">
                <i class="fas fa-paper-plane"></i>
                Submit Review
            </button>
        </form>
    </div>
</div>

<style>
.comments-section {
    background: #f8f9fa;
    padding: 3rem 2rem;
    margin: 2rem 0;
    border-radius: 15px;
}

.comments-header {
    text-align: center;
    margin-bottom: 2rem;
}

.comments-header h3 {
    color: #e74c3c;
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.comments-header p {
    color: #666;
    font-size: 1.1rem;
}

.comments-display {
    margin-bottom: 3rem;
}

.loading-comments {
    text-align: center;
    color: #666;
    padding: 2rem;
}

.comment-card {
    background: white;
    padding: 1.5rem;
    margin-bottom: 1rem;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border-left: 4px solid #e74c3c;
}

.comment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.comment-author {
    font-weight: 600;
    color: #2c3e50;
    font-size: 1.1rem;
}

.comment-date {
    color: #666;
    font-size: 0.9rem;
}

.comment-rating {
    color: #ffd700;
    font-size: 1.2rem;
    margin-bottom: 0.5rem;
}

.comment-text {
    color: #555;
    line-height: 1.6;
    font-style: italic;
}

.add-comment-form {
    background: white;
    padding: 2rem;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
}

.add-comment-form h4 {
    color: #2c3e50;
    margin-bottom: 1.5rem;
    text-align: center;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1rem;
}

.form-group {
    margin-bottom: 1rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: #2c3e50;
    font-weight: 600;
}

.form-group input,
.form-group textarea {
    width: 100%;
    padding: 0.8rem;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
}

.form-group input:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #e74c3c;
}

.rating-input {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.rating-input input[type="radio"] {
    display: none;
}

.rating-input .star {
    font-size: 2rem;
    color: #ddd;
    cursor: pointer;
    transition: color 0.2s ease;
}

.rating-input input[type="radio"]:checked ~ .star,
.rating-input .star:hover {
    color: #ffd700;
}

.rating-input input[type="radio"]:checked ~ .star ~ .star {
    color: #ffd700;
}

.submit-comment-btn {
    background: #e74c3c;
    color: white;
    padding: 1rem 2rem;
    border: none;
    border-radius: 50px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0 auto;
}

.submit-comment-btn:hover {
    background: #c0392b;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
}

.no-comments {
    text-align: center;
    color: #666;
    padding: 2rem;
    font-style: italic;
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .comment-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
    
    .rating-input .star {
        font-size: 1.5rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Load comments when component is loaded
    loadComments();
    
    // Handle comment form submission
    document.getElementById('comment-form').addEventListener('submit', function(e) {
        e.preventDefault();
        submitComment();
    });
    
    // Handle star rating clicks
    document.querySelectorAll('.rating-input input[type="radio"]').forEach(input => {
        input.addEventListener('change', function() {
            updateStarDisplay();
        });
    });
});

function loadComments() {
    fetch('/api/comments')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                displayComments(data.comments);
            } else {
                showError('Failed to load comments');
            }
        })
        .catch(error => {
            console.error('Error loading comments:', error);
            showError('Failed to load comments');
        });
}

function displayComments(comments) {
    const container = document.getElementById('comments-display');
    
    if (comments.length === 0) {
        container.innerHTML = '<div class="no-comments">No comments yet. Be the first to share your experience!</div>';
        return;
    }
    
    container.innerHTML = comments.map(comment => `
        <div class="comment-card">
            <div class="comment-header">
                <div class="comment-author">${comment.name}</div>
                <div class="comment-date">${new Date(comment.created_at).toLocaleDateString()}</div>
            </div>
            <div class="comment-rating">${'★'.repeat(comment.rating)}</div>
            <div class="comment-text">${comment.comment}</div>
        </div>
    `).join('');
}

function submitComment() {
    const form = document.getElementById('comment-form');
    const formData = new FormData(form);
    
    const commentData = {
        name: formData.get('name'),
        email: formData.get('email'),
        comment: formData.get('comment'),
        rating: parseInt(formData.get('rating'))
    };
    
    fetch('/api/comments', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(commentData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showSuccess(data.message);
            form.reset();
            updateStarDisplay();
            loadComments(); // Reload comments
        } else {
            showError(data.message);
        }
    })
    .catch(error => {
        console.error('Error submitting comment:', error);
        showError('Failed to submit comment');
    });
}

function updateStarDisplay() {
    const checkedInput = document.querySelector('.rating-input input[type="radio"]:checked');
    const stars = document.querySelectorAll('.rating-input .star');
    
    stars.forEach((star, index) => {
        if (index < checkedInput.value) {
            star.style.color = '#ffd700';
        } else {
            star.style.color = '#ddd';
        }
    });
}

function showSuccess(message) {
    // Create success message
    const successDiv = document.createElement('div');
    successDiv.className = 'success-message';
    successDiv.textContent = message;
    successDiv.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        background: #27ae60;
        color: white;
        padding: 1rem 2rem;
        border-radius: 8px;
        z-index: 1000;
        animation: slideIn 0.3s ease;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    `;
    
    document.body.appendChild(successDiv);
    
    setTimeout(() => {
        successDiv.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => successDiv.remove(), 300);
    }, 3000);
}

function showError(message) {
    // Create error message
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-message';
    errorDiv.textContent = message;
    errorDiv.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        background: #e74c3c;
        color: white;
        padding: 1rem 2rem;
        border-radius: 8px;
        z-index: 1000;
        animation: slideIn 0.3s ease;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    `;
    
    document.body.appendChild(errorDiv);
    
    setTimeout(() => {
        errorDiv.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => errorDiv.remove(), 300);
    }, 3000);
}

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
document.head.appendChild(style);
</script>
